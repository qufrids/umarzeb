// Prisma Schema for AI Engineer Portfolio Backend
// Database: PostgreSQL (Supabase)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER & AUTHENTICATION
// ============================================

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String    // Hashed
  role          Role      @default(ADMIN)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  blogPosts     BlogPost[]
  projects      Project[]

  @@map("users")
}

enum Role {
  ADMIN
  EDITOR
  VIEWER
}

// ============================================
// BLOG / CMS
// ============================================

model BlogPost {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  excerpt     String?
  content     String   @db.Text
  coverImage  String?
  published   Boolean  @default(false)
  featured    Boolean  @default(false)
  views       Int      @default(0)

  // SEO
  metaTitle       String?
  metaDescription String?

  // Relations
  authorId    String
  author      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  tags        Tag[]

  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([slug])
  @@index([published])
  @@index([publishedAt])
  @@map("blog_posts")
}

model Tag {
  id        String     @id @default(cuid())
  name      String     @unique
  slug      String     @unique
  posts     BlogPost[]

  createdAt DateTime   @default(now())

  @@map("tags")
}

// ============================================
// PORTFOLIO PROJECTS
// ============================================

model Project {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  description String
  content     String   @db.Text

  // Technical details
  technologies Json     // ["Next.js", "TailwindCSS", "Prisma"]
  githubUrl   String?
  liveUrl     String?
  coverImage  String?

  // Metrics
  stars       Int?
  downloads   Int?

  featured    Boolean  @default(false)
  order       Int      @default(0)
  published   Boolean  @default(true)

  // Relations
  authorId    String
  author      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  category    ProjectCategory?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([featured])
  @@map("projects")
}

enum ProjectCategory {
  AI_ML
  WEB_APP
  MOBILE_APP
  API
  OPEN_SOURCE
  RESEARCH
  OTHER
}

// ============================================
// CONTACT FORM
// ============================================

model Message {
  id        String        @id @default(cuid())
  name      String
  email     String
  subject   String?
  message   String        @db.Text

  status    MessageStatus @default(UNREAD)
  replied   Boolean       @default(false)

  // Spam prevention
  ipAddress String?
  userAgent String?

  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([status])
  @@index([createdAt])
  @@map("messages")
}

enum MessageStatus {
  UNREAD
  READ
  ARCHIVED
  SPAM
}

// ============================================
// ANALYTICS
// ============================================

model PageView {
  id        String   @id @default(cuid())

  // Page info
  path      String
  title     String?
  referrer  String?

  // Visitor info
  visitorId String?  // Anonymous ID
  ipAddress String?
  userAgent String?
  country   String?
  device    String?
  browser   String?

  // Metrics
  duration  Int?     // Time spent on page (seconds)

  createdAt DateTime @default(now())

  @@index([path])
  @@index([createdAt])
  @@index([visitorId])
  @@map("page_views")
}

model Event {
  id         String   @id @default(cuid())

  // Event data
  name       String   // "button_click", "form_submit", etc.
  category   String?  // "engagement", "conversion", etc.
  label      String?
  value      Int?

  // Context
  path       String
  visitorId  String?

  // Metadata
  metadata   Json?

  createdAt  DateTime @default(now())

  @@index([name])
  @@index([createdAt])
  @@map("events")
}

// ============================================
// SITE SETTINGS
// ============================================

model Settings {
  id    String @id @default(cuid())
  key   String @unique
  value Json

  updatedAt DateTime @updatedAt

  @@map("settings")
}

// Settings stored as JSON:
// {
//   "site": {
//     "title": "Umar Zeb - AI Engineer",
//     "description": "...",
//     "url": "https://umarzeb.com"
//   },
//   "social": {
//     "github": "qufrids",
//     "twitter": "umarzeb",
//     "linkedin": "umarzeb"
//   },
//   "contact": {
//     "email": "contact@umarzeb.com",
//     "location": "..."
//   },
//   "seo": {
//     "keywords": ["AI", "Machine Learning", ...],
//     "ogImage": "..."
//   },
//   "features": {
//     "blog": true,
//     "analytics": true,
//     "contactForm": true
//   }
// }

// ============================================
// NEWSLETTER (Optional)
// ============================================

model Subscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  active    Boolean  @default(true)

  // Double opt-in
  verified  Boolean  @default(false)
  token     String?  @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@map("subscribers")
}
